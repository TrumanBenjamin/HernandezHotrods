<main class="contact-split">
  <!-- LEFT: media  -->
  <aside class="contact-media">
    <video class="media-video" autoplay muted loop playsinline>
      <source src="<%= R2_BASE %>/media/nova.mp4" type="video/mp4" />
    </video>
   
  </aside>

  <!-- RIGHT: panel -->
  <section class="contact-panel angle-caps">
    <header class="contact-header">
      <h1>Contact Us</h1>
      <p class="sub">
        If you have any questions, are ready to pull the trigger on your dream build, or are interested in any of our vehicles for sale,
        weâ€™d love to hear from you!
      </p>
    </header>

    <!-- Flash / errors -->
    <% if (errors && errors.length > 0) { %>
      <ul class="form-flash form-errors">
        <% errors.forEach(error => { %>
          <li><%= error %></li>
        <% }) %>
      </ul>
    <% } %>

    <% if (success) { %>
      <p class="form-flash form-success"><%= success %></p>
    <% } %>

    <!-- Contact form -->
    <form action="/contact" method="POST" novalidate class="contact-form slim" enctype="multipart/form-data">
      <div class="row two-col">
        <div class="field">
          <label for="name">Full Name</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder=""
            value="<%= formData?.name || '' %>"
            required
            minlength="2"
          />
        </div>

        <div class="field">
          <label for="email">Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder=""
            value="<%= formData?.email || '' %>"
            required
          />
        </div>
      </div>


      <div class="field">
        <label for="vehicle">Vehicle Info <span class="optional">(optional)</span></label>
        <input
          type="text"
          id="vehicle"
          name="vehicle"
          placeholder="Year, make, model, engine, etc."
          value="<%= formData?.vehicle || '' %>"
        />
      </div>

      <div class="field">
        <label for="message">Message</label>
        <textarea
          id="message"
          name="message"
          placeholder="Tell us about your project..."
          required
          minlength="10"
        ><%= formData?.message || '' %></textarea>
      </div>

      <div class="field">
        <input
          type="file"
          id="photos"
          name="photos"
          accept="image/*"
          multiple
        />
        <small>PNG/JPG/WebP. Up to 5 images, 25MB total.</small>
      </div>
      <div class="button-wrap">
        <button type="submit" class="btn-send" id="contactSendBtn">
          <span class="send-btn__text">Send</span>
          <span class="send-btn__spinner" aria-hidden="true"></span>
        </button>
      </div>
      
    </form>

    <div class="more-info">
      More information, like our address and phone number, available 
      <a href="https://share.google/RlZZ6wbnBc6wLkito">here.</a>
    </div>
  </section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Success: auto fade out (same behavior you have now)
    const success = document.querySelector('.form-flash.form-success');
    if (success) {
      setTimeout(() => {
        success.classList.add('fade-out');
        setTimeout(() => success.remove(), 1050);
      }, 5000);
    }

    // Errors: stay until next submission
    const form = document.querySelector('form.contact-form');
    const errors = document.querySelector('.form-flash.form-errors');

    if (form && errors) {
      form.addEventListener('submit', () => {
        errors.remove();
      }, { once: true }); // only need this once
    }

    // client-side guard (nice UX, server still validates)
    const input = document.getElementById('photos');
    if (!input) return;

    const MAX_FILES = 5;
    const MAX_TOTAL = 25 * 1024 * 1024; // 25MB total

    const formatMB = (bytes) => (bytes / (1024 * 1024)).toFixed(1);

    input.addEventListener('change', (e) => {
      const files = Array.from(e.target.files || []);

      // max count
      if (files.length > MAX_FILES) {
        alert(`Please select at most ${MAX_FILES} images.`);
        e.target.value = '';
        return;
      }

      // total size
      const totalBytes = files.reduce((sum, f) => sum + (f.size || 0), 0);
      if (totalBytes > MAX_TOTAL) {
        alert(
          `Your selected images total ${formatMB(totalBytes)}MB.\n` +
          `Please keep the total under ${formatMB(MAX_TOTAL)}MB.`
        );
        e.target.value = '';
        return;
      }
    });
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form.contact-form');
    const btn  = document.getElementById('contactSendBtn');
    const text = btn?.querySelector('.send-btn__text');

    if (!form || !btn || !text) return;

    form.addEventListener('submit', () => {
      // lock button + show loading state
      btn.classList.add('is-loading');
      btn.disabled = true;
      text.textContent = 'Sending';

      // optional: prevent double-submit by disabling fields
      form.querySelectorAll('input, textarea,').forEach(el => {
        if (el.type === 'file') return;
        el.readOnly = true;
      });
    });
  });
</script>


</main>
